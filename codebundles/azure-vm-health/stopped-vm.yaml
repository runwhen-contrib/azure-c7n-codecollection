policies:
  - name: stopped-vms
    resource: azure.vm
    subscription: 2a0cf760-baef-4446-b75c-75c4f8a6267f
    filters:
      # 1. List only VMs that are stopped (deallocated)
      - type: instance-view
        key: statuses[].code
        op: in
        value_type: swap
        value: PowerState/deallocated

      # 2. Ensure the VM has had 0% CPU usage since 24
      - type: metric
        metric: Percentage CPU
        op: eq
        aggregation: average
        threshold: 0
        timeframe: 24 

      - type: value
        key: resourceGroup
        op: eq
        value: RG-CONTOSO-01-DATA